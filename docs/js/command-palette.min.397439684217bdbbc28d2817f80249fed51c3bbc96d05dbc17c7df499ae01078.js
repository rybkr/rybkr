(function(){"use strict";let l=null,o=[],t=-1,e=[];const n=document.getElementById("command-palette"),r=document.getElementById("command-palette-input"),i=document.getElementById("command-palette-results");async function v(){if(o.length>0)return;try{const e=await fetch("/index.json");o=await e.json(),l=new Fuse(o,{keys:[{name:"title",weight:2},{name:"summary",weight:1},{name:"tags",weight:1.5},{name:"stack",weight:1.5}],threshold:.3,ignoreLocation:!0,includeScore:!0,includeMatches:!0})}catch(e){console.error("Failed to load search index:",e)}}function d(e){const t=e.match(/^\/(\S+)\s*(.*)?$/);return t?{tag:t[1].toLowerCase(),search:(t[2]||"").trim()}:{tag:null,search:e.trim()}}function u(e,t){return e.filter(e=>{const n=(e.tags||[]).map(e=>e.toLowerCase()),s=(e.stack||[]).map(e=>e.toLowerCase());return n.includes(t)||s.includes(t)})}function p(n){if(!l||!n){e=[],a();return}const{tag:s,search:i}=d(n);if(s&&!i)e=u(o,s).map(e=>({item:e}));else if(s&&i){const t=u(o,s),n=new Fuse(t,{keys:[{name:"title",weight:2},{name:"summary",weight:1}],threshold:.3,ignoreLocation:!0,includeScore:!0});e=n.search(i)}else e=l.search(i);t=e.length>0?0:-1,a()}function a(){if(e.length===0){const e=r.value.trim(),{tag:t}=d(e);if(t&&!e.includes(" ")){const n=g(),e=n.filter(e=>e.toLowerCase().includes(t.toLowerCase()));if(e.length>0){i.innerHTML=`
            <div class="command-palette-tag-suggestions">
              <div class="command-palette-hint">Filter by tag:</div>
              ${e.slice(0,8).map(e=>`<button class="command-palette-tag-btn" data-tag="${s(e)}">${s(e)}</button>`).join("")}
            </div>
          `;return}}i.innerHTML=e?'<div class="command-palette-empty">No results found</div>':'<div class="command-palette-empty">Type to search, or /tag to filter</div>';return}i.innerHTML=e.slice(0,10).map((e,n)=>{const o=e.item,i=[...o.tags||[],...o.stack||[]],a=i.length?`<span class="command-palette-tags">${i.map(e=>`<button class="command-palette-tag" data-tag="${s(e)}">${s(e)}</button>`).join("")}</span>`:"";return`
        <a href="${s(o.permalink)}"
           class="command-palette-result ${n===t?"selected":""}"
           data-index="${n}">
          <span class="command-palette-title">${s(o.title)}</span>
          <span class="command-palette-meta">
            <span class="command-palette-section">${s(o.section)}</span>
            ${a}
          </span>
        </a>
      `}).join("")}function g(){const e=new Set;return o.forEach(t=>{(t.tags||[]).forEach(t=>e.add(t)),(t.stack||[]).forEach(t=>e.add(t))}),Array.from(e).sort()}function s(e){const t=document.createElement("div");return t.textContent=e||"",t.innerHTML}function h(){v(),n.classList.add("open"),n.setAttribute("aria-hidden","false"),r.focus(),document.body.style.overflow="hidden"}function c(){n.classList.remove("open"),n.setAttribute("aria-hidden","true"),r.value="",e=[],t=-1,a(),document.body.style.overflow=""}function m(n){if(e.length===0)return;t=(t+n+e.length)%e.length,a();const s=i.querySelector(".selected");s&&s.scrollIntoView({block:"nearest"})}function f(){t>=0&&e[t]&&(window.location.href=e[t].item.permalink)}document.addEventListener("keydown",e=>{if((e.metaKey||e.ctrlKey)&&e.key==="k"){e.preventDefault(),n.classList.contains("open")?c():h();return}if(e.key==="/"&&!b()){e.preventDefault(),h();return}if(!n.classList.contains("open"))return;switch(e.key){case"Escape":e.preventDefault(),c();break;case"ArrowDown":e.preventDefault(),m(1);break;case"ArrowUp":e.preventDefault(),m(-1);break;case"Enter":e.preventDefault(),f();break}});function b(){const e=document.activeElement;return e&&(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.isContentEditable)}n.querySelector(".command-palette-backdrop").addEventListener("click",c),r.addEventListener("input",e=>{p(e.target.value)}),i.addEventListener("click",e=>{const n=e.target.closest(".command-palette-result");if(n){const e=parseInt(n.dataset.index,10);isNaN(e)||(t=e,f())}}),i.addEventListener("mousemove",e=>{const n=e.target.closest(".command-palette-result");if(n){const e=parseInt(n.dataset.index,10);!isNaN(e)&&e!==t&&(t=e,a())}})})()