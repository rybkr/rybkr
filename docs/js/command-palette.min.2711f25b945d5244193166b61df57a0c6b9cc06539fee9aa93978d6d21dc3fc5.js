(function(){"use strict";let l=null,a=[],t=-1,e=[];const n=document.getElementById("command-palette"),s=document.getElementById("command-palette-input"),o=document.getElementById("command-palette-results");async function v(){if(a.length>0)return;try{const e=await fetch("/index.json");a=await e.json(),l=new Fuse(a,{keys:[{name:"title",weight:2},{name:"summary",weight:1},{name:"tags",weight:1.5}],threshold:.3,ignoreLocation:!0,includeScore:!0,includeMatches:!0})}catch(e){console.error("Failed to load search index:",e)}}function d(e){const t=e.match(/^\/(\S+)\s*(.*)?$/);return t?{tag:t[1].toLowerCase(),search:(t[2]||"").trim()}:{tag:null,search:e.trim()}}function h(e,t){return e.filter(e=>{const n=(e.tags||[]).map(e=>e.toLowerCase());return n.includes(t)})}function u(n){if(!l||!n){e=[],r();return}const{tag:s,search:o}=d(n);if(s&&!o)e=h(a,s).map(e=>({item:e}));else if(s&&o){const t=h(a,s),n=new Fuse(t,{keys:[{name:"title",weight:2},{name:"summary",weight:1}],threshold:.3,ignoreLocation:!0,includeScore:!0});e=n.search(o)}else e=l.search(o);t=e.length>0?0:-1,r()}function r(){if(e.length===0){const e=s.value.trim(),{tag:t}=d(e);if(t&&!e.includes(" ")){const n=g(),e=n.filter(e=>e.toLowerCase().includes(t.toLowerCase()));if(e.length>0){o.innerHTML=`
            <div class="command-palette-tag-suggestions">
              <div class="command-palette-hint">Filter by tag:</div>
              ${e.slice(0,8).map(e=>`<button class="command-palette-tag-btn" data-tag="${i(e)}">${i(e)}</button>`).join("")}
            </div>
          `;return}}o.innerHTML=e?'<div class="command-palette-empty">No results found</div>':'<div class="command-palette-empty">Type to search, or /tag to filter</div>';return}o.innerHTML=e.slice(0,10).map((e,n)=>{const s=e.item,o=s.tags||[],a=o.length?`<span class="command-palette-tags">${o.map(e=>`<button class="command-palette-tag" data-tag="${i(e)}">${i(e)}</button>`).join("")}</span>`:"";return`
        <a href="${i(s.permalink)}"
           class="command-palette-result ${n===t?"selected":""}"
           data-index="${n}">
          <span class="command-palette-title">${i(s.title)}</span>
          <span class="command-palette-meta">
            <span class="command-palette-section">${i(s.section)}</span>
            ${a}
          </span>
        </a>
      `}).join("")}function g(){const e=new Set;return a.forEach(t=>{(t.tags||[]).forEach(t=>e.add(t))}),Array.from(e).sort()}function i(e){const t=document.createElement("div");return t.textContent=e||"",t.innerHTML}function m(){v(),n.classList.add("open"),n.setAttribute("aria-hidden","false"),s.focus(),document.body.style.overflow="hidden"}function c(){n.classList.remove("open"),n.setAttribute("aria-hidden","true"),s.value="",e=[],t=-1,r(),document.body.style.overflow=""}function f(n){if(e.length===0)return;t=(t+n+e.length)%e.length,r();const s=o.querySelector(".selected");s&&s.scrollIntoView({block:"nearest"})}function p(){t>=0&&e[t]&&(window.location.href=e[t].item.permalink)}document.addEventListener("keydown",e=>{if((e.metaKey||e.ctrlKey)&&e.key==="k"){e.preventDefault(),n.classList.contains("open")?c():m();return}if(e.key==="/"&&!b()){e.preventDefault(),m();return}if(!n.classList.contains("open"))return;switch(e.key){case"Escape":e.preventDefault(),c();break;case"ArrowDown":e.preventDefault(),f(1);break;case"ArrowUp":e.preventDefault(),f(-1);break;case"Enter":e.preventDefault(),p();break}});function b(){const e=document.activeElement;return e&&(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.isContentEditable)}n.querySelector(".command-palette-backdrop").addEventListener("click",c),s.addEventListener("input",e=>{u(e.target.value)}),o.addEventListener("click",e=>{const n=e.target.closest(".command-palette-result");if(n){const e=parseInt(n.dataset.index,10);isNaN(e)||(t=e,p())}}),o.addEventListener("mousemove",e=>{const n=e.target.closest(".command-palette-result");if(n){const e=parseInt(n.dataset.index,10);!isNaN(e)&&e!==t&&(t=e,r())}}),o.addEventListener("click",e=>{const t=e.target.closest("[data-tag]");if(t){e.preventDefault(),e.stopPropagation();const n=t.dataset.tag;s.value="/"+n,s.focus(),u(s.value)}})})()