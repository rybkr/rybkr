{{ define "main" }}
<main>
    <h1>Projects</h1>
    <p class="project-intro">A selection of work and research.</p>

    <input
        id="project-search"
        class="project-search"
        type="search"
        placeholder="Search projectsâ€¦"
        aria-label="Search projects"
    />

    <div id="project-filters" class="filter-bar">
        {{ $tags := slice }} {{ range .Pages }} {{ range .Params.tags }} {{
        $tags = $tags | append . }} {{ end }} {{ end }} {{ $unique := $tags |
        uniq | sort }} {{ range $unique }}
        <button class="filter-pill" data-tag="{{ . }}">{{ . }}</button>
        {{ end }}
    </div>

    <section id="projects">
        {{ range .Pages.ByDate.Reverse }}
        <article class="project-card" data-tags="{{ .Params.tags | jsonify }}">
            <div class="card-left">
                <h2><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>

                {{ with .Params.subtitle }}
                <p class="project-card-subtitle">{{ . }}</p>
                {{ end }} {{ $stack := .Params.stack | default slice }} {{ $tags
                := .Params.tags | default slice }} {{ $allTags := slice }} {{
                range $stack }} {{ $allTags = $allTags | append . }} {{ end }}
                {{ range $tags }} {{ if not (in $stack .) }} {{ $allTags =
                $allTags | append . }} {{ end }} {{ end }} {{ $tagIcons := dict
                "go" "/icons/tags/go.svg" "c" "/icons/tags/c.svg" }}

                <div class="tag-row">
                    {{ range $allTags }} {{ $tag := lower . }} {{ $icon := index
                    $tagIcons $tag }}
                    <span class="tag-pill">
                        {{ if $icon }}
                        <img src="{{ $icon }}" alt="{{ . }} icon" />
                        {{ end }}
                        <span class="tag-label">{{ . }}</span>
                    </span>
                    {{ end }}
                </div>
            </div>

            <div class="card-middle">
                {{ with .Params.summary }} {{ if ne . "" }}
                <p>{{ . }}</p>
                {{ end }} {{ end }}
            </div>

            <div class="card-right">
                {{ with .Params.thumbnail }}
                <img
                    class="project-thumb"
                    src="{{ . }}"
                    alt="{{ $.Title }} thumbnail"
                />
                {{ end }}
            </div>
        </article>

        {{ end }}
    </section>
</main>
<script src="/js/projects-filter.js"></script>
{{ end }}
