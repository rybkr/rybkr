{{ define "main" }}
<main>
    {{ partial "breadcrumb.html" . }}
    <div class="page-header enter">
        <h1>Projects</h1>
        {{ partial "search-hint.html" . }}
    </div>
    <p class="project-intro enter enter-d1">A selection of work and research.</p>

    <div id="project-filters" class="filter-bar enter enter-d2">
        <div class="filter-group">
            <span class="filter-group-label">Language</span>
            {{- range slice "C" "C++" "Python" "Go" "Lua" "JS" -}}
                <button class="filter-pill" data-tag="{{ . }}">{{ . }}</button>
            {{- end -}}
        </div>
        <div class="filter-group">
            <span class="filter-group-label">Domain</span>
            {{- range slice "Embedded" "Algorithms" "Game Dev" "Web Dev" "Tools" -}}
                <button class="filter-pill" data-tag="{{ . }}">{{ . }}</button>
            {{- end -}}
        </div>
        <div class="filter-group">
            <span class="filter-group-label">Tools</span>
            {{- range slice "CLI" "Neovim" "Config" "Make" "PlatformIO" -}}
                <button class="filter-pill" data-tag="{{ . }}">{{ . }}</button>
            {{- end -}}
        </div>
    </div>

    <p id="no-results" class="no-results" style="display: none;">No projects match the selected filters.</p>

    <section id="projects" class="enter enter-d3">
        {{ range .Pages.ByDate.Reverse }}
        {{- $cardTags := .Params.tags | default slice -}}
        {{- range .Params.stack | default slice -}}
            {{- if not (in $cardTags .) -}}
                {{- $cardTags = $cardTags | append . -}}
            {{- end -}}
        {{- end -}}
        <article class="project-card" data-tags="{{ $cardTags | jsonify }}">
            <div class="card-left">
                {{- $projectURL := "" -}}
                {{- $isExternal := false -}}
                {{- if .Params.redirect -}}
                    {{- $projectURL = .Params.redirect -}}
                    {{- $isExternal = true -}}
                {{- else if .Params.github -}}
                    {{- $projectURL = .Params.github -}}
                    {{- $isExternal = true -}}
                {{- else if .Content -}}
                    {{- $projectURL = .RelPermalink -}}
                {{- else -}}
                    {{- $projectURL = printf "https://github.com/rybkr/%s" .File.ContentBaseName -}}
                    {{- $isExternal = true -}}
                {{- end -}}
                <h2>
                    <a href="{{ $projectURL }}"{{ if $isExternal }} target="_blank" rel="noopener"{{ end }}>
                        {{ .Title }}
                    </a>
                    {{- if .Params.wip -}}
                    <span class="wip-badge">WIP</span>
                    {{- end -}}
                </h2>

                {{ with .Params.subtitle }}
                <p class="project-card-subtitle">{{ . }}</p>
                {{ end }} {{ $stack := .Params.stack | default slice }} {{ $tags
                := .Params.tags | default slice }} {{ $allTags := slice }} {{
                range $stack }} {{ $allTags = $allTags | append . }} {{ end }}
                {{ range $tags }} {{ if not (in $stack .) }} {{ $allTags =
                $allTags | append . }} {{ end }} {{ end }} {{ $tagIcons := dict
                "go" "/icons/tags/go.svg" "c" "/icons/tags/c.svg" "js"
                "/icons/tags/js.svg" "html" "/icons/tags/html.svg" "css"
                "/icons/tags/css.svg" "cli" "/icons/tags/term.svg" "c++"
                "/icons/tags/cpp.svg" "git" "/icons/tags/git.svg" "python"
                "/icons/tags/python.svg" "lua" "/icons/tags/lua.svg" "sql"
                "/icons/tags/sql.svg" "neovim" "/icons/tags/nvim.svg" }}

                <div class="tag-row">
                    {{ range $allTags }} {{ $tag := lower . }} {{ $icon := index
                    $tagIcons $tag }}
                    <span class="tag-pill">
                        {{ if $icon }}
                        <img src="{{ $icon }}" alt="{{ . }} icon" />
                        {{ end }}
                        <span class="tag-label">{{ . }}</span>
                    </span>
                    {{ end }}
                </div>
            </div>

            <div class="card-middle">
                {{ with .Params.summary }} {{ if ne . "" }}
                <p>{{ . }}</p>
                {{ end }} {{ end }}
            </div>

            <div class="card-right">
                {{ with .Params.thumbnail }}
                <img
                    class="project-thumb"
                    src="{{ . }}"
                    alt="{{ $.Title }} thumbnail"
                />
                {{ end }}
            </div>
        </article>

        {{ end }}
    </section>
</main>
<script src="/js/projects-filter.js"></script>
{{ end }}
